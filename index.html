<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Chat Sem√¢ntico POPs</title>
<style>
body { font-family: Arial; max-width: 700px; margin: 20px auto; }
#chat { border: 1px solid #ccc; padding: 10px; height: 400px; overflow-y: auto; }
.msg { margin: 5px 0; white-space: pre-wrap; }
.user { color: blue; }
.bot { color: green; }
input { width: 80%; padding: 5px; }
button { padding: 5px 10px; }
</style>
</head>
<body>
<h2>Chat Sem√¢ntico - POPs Institucionais</h2>
<div id="chat"></div>
<input type="text" id="pergunta" placeholder="Digite sua pergunta..." />
<button onclick="fazerPergunta()">Enviar</button>

<script>
let pops = [];

// Carregar JSON dos POPs
async function carregarPOPs(){
  const resp = await fetch("pops.json");
  pops = await resp.json();
  adicionarMensagem("POP(s) carregados. Pronto para responder perguntas!", "bot");
}

// Fun√ß√£o de chat
function adicionarMensagem(texto, classe){
  const chat = document.getElementById("chat");
  const div = document.createElement("div");
  div.className = "msg " + classe;
  div.textContent = texto;
  chat.appendChild(div);
  chat.scrollTop = chat.scrollHeight;
}

// Busca por palavras-chave
function buscarResposta(pergunta){
  let palavras = pergunta.toLowerCase().split(/\s+/);
  let melhor = {score:0,texto:""};
  
  for(const pop of pops){
    for(const chunk of pop.chunks){
      let score = 0;
      for(const k of chunk.keywords){
        if(palavras.includes(k.toLowerCase())) score++;
      }
      if(score > melhor.score) melhor = {score, texto:`üìÑ ${pop.titulo}:\n${chunk.texto}`};
    }
  }
  
  if(melhor.score > 0) return melhor.texto;
  else return "N√£o h√° informa√ß√£o sobre isso nos POPs.";
}

function fazerPergunta(){
  const input = document.getElementById("pergunta");
  const pergunta = input.value.trim();
  if(!pergunta) return;
  adicionarMensagem("Voc√™: "+pergunta,"user");
  input.value = "";
  adicionarMensagem("Assistente: ... pesquisando ...","bot");
  
  setTimeout(() => {
    const resposta = buscarResposta(pergunta);
    const chatDiv = document.getElementById("chat");
    chatDiv.removeChild(chatDiv.lastChild);
    adicionarMensagem("Assistente: "+resposta,"bot");
  }, 200); // simula leve delay
}

// Inicia
carregarPOPs();
</script>
</body>
</html>
